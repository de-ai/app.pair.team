#!/bin/bash


#-- switch this screipt's dir
if [ `pwd` != `dirname $0` ]; then cd `dirname $0`; fi


#-- declares branch name frmt using current date (default: wip/YYYMMDD
cfg_path=./wip_branch_rc


#-- start off getting config from rc file
if [ -f "$cfg_path" ]; then ./wip_branch_rc ; fi


#-- wip branch name
branch_name="wip/mh-$(date +%Y%m%d)"

#-- change to proj dir
if [[ ! -z "`pwd`/package.json" ]]; then cd `dirname $0`/../ ; fi


#-- check for 'develop' branch
if [[ ! -z "`git branch | grep develop`" ]]; then

	#-- not on 'develop'
	if [[ -z "`git branch | grep '* develop'`" ]]; then

		#-- no changes
		if [[ -z "`git status | grep clean`" ]]; then git checkout develop
		else
			printf "Uncommitted changes, commit 'em, then try again.\n"
			exit 0;
		fi
	fi

else
	printf "No develop branch for this repo.\n"
	exit 0;
fi


#-- make new wip branch
if [[ -z "`git branch | grep ${branch_name}`" ]]; then
	git checkout -b "${branch_name}"

else #-- suffix index onto branch name if already one
	ind=$(( `git branch | grep ${branch_name} | wc -l | awk '{print $NF}'`+1 ))
	git checkout -b "${branch_name}.${ind}"

	if [[ ! -z "`git status | grep clean`" ]]; then git add . ; fi
fi


#-- show remote
git config --get remote.origin.url


#-- terminate w/o error
exit 0;
